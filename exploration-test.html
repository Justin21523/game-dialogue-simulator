<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Exploration Test</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/screens/exploration.css">
    
    <!-- axiosï¼ˆapi-client.js éœ€è¦ï¼‰-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <!-- THREE.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.149.0/build/three.min.js"></script>
    
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        #game-container { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="ui-layer"></div>
    </div>
    <script type="module">
        import { gameState } from './js/core/game-state.js';
        import { ExplorationScreen } from './js/ui/screens/exploration-new.js';
        
        console.log('========================================');
        console.log('ğŸš€ æ¢ç´¢æ¨¡å¼æ¸¬è©¦');
        console.log('========================================\n');
        
        console.log('[Test] åˆå§‹åŒ– gameState...');
        gameState.init();
        
        const dest = new URLSearchParams(location.search).get('destination') || 'paris';
        console.log('[Test] ç›®çš„åœ°:', dest);
        
        console.log('[Test] å‰µå»º ExplorationScreen...');
        const screen = new ExplorationScreen('ui-layer', {
            destination: dest,
            difficulty: 'normal',
            characterId: 'jett',
            missionType: 'delivery'
        });
        
        console.log('[Test] æ¸²æŸ“ä¸­...');
        await screen.render();
        
        window.currentScreen = screen;
        console.log('[Test] âœ… window.currentScreen å·²è¨­ç½®\n');
        
        // å»¶é² 2 ç§’å¾Œæª¢æŸ¥ ThreeRenderer
        setTimeout(() => {
            console.log('========================================');
            console.log('ğŸ” ThreeRenderer è¨ºæ–·');
            console.log('========================================\n');
            
            if (!screen.threeRenderer) {
                console.error('âŒ ThreeRenderer æœªåˆå§‹åŒ–ï¼');
                console.log('è«‹å¾€ä¸Šæ»¾å‹• Consoleï¼Œæœå°‹ "ThreeRenderer" æˆ– "THREE" æŸ¥çœ‹éŒ¯èª¤');
            } else {
                console.log('âœ… ThreeRenderer å·²åˆå§‹åŒ–');
                
                const stats = screen.threeRenderer.getStats();
                console.log('çµ±è¨ˆè³‡è¨Š:', stats);
                
                if (stats.characters === 0) {
                    console.warn('âš ï¸ æ²’æœ‰ 3D æ¨¡å‹ï¼Œæ‰‹å‹•å‰µå»º...');
                    screen.npcs.forEach(npc => {
                        screen.threeRenderer.addNPCModel(npc.id, npc);
                    });
                    console.log('âœ… å·²å‰µå»º', screen.npcs.length, 'å€‹ NPC 3D æ¨¡å‹');
                } else {
                    console.log('âœ… 3D æ¨¡å‹å·²å­˜åœ¨ï¼Œæ‡‰è©²èƒ½çœ‹åˆ°è—è‰²è† å›Šï¼');
                }
                
                // æª¢æŸ¥ Canvas 3D
                if (screen.threeRenderer.canvas3D) {
                    console.log('Canvas 3D è³‡è¨Š:');
                    console.log('  å°ºå¯¸:', screen.threeRenderer.canvas3D.width, 'x', screen.threeRenderer.canvas3D.height);
                    console.log('  Z-index:', screen.threeRenderer.canvas3D.style.zIndex);
                    console.log('  Position:', screen.threeRenderer.canvas3D.style.position);
                }
            }
            
            console.log('\n========================================');
        }, 2000);
    </script>
</body>
</html>
