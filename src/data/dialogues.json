{
    "dialogues": [
        {
            "dialogue_id": "dlg_dispatcher_offer",
            "npc_id": "npc_dispatcher",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Paul",
                    "lines": [
                        "Hey pilot! We have a problem at the Warehouse District.",
                        "A signal relay is down and deliveries are stuck.",
                        "Can you head over there and call in Engineering support to fix it?"
                    ],
                    "choices": [
                        {
                            "choice_id": "accept",
                            "text": "I'll take the job.",
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_repair_relay" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        {
                            "choice_id": "town_help",
                            "text": "Any work in the Town District?",
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_main_town_welcome" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        {
                            "choice_id": "decline",
                            "text": "Not right now.",
                            "actions": [{ "type": "close_dialogue" }]
                        }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_dispatcher_active",
            "npc_id": "npc_dispatcher",
            "start_node_id": "active",
            "nodes": [
                {
                    "node_id": "active",
                    "speaker_name": "Paul",
                    "lines": [
                        "You're currently assigned to a job.",
                        "Head to the Warehouse District and repair the relay. Call Engineering if you need help."
                    ],
                    "choices": [
                        {
                            "choice_id": "close",
                            "text": "On it.",
                            "actions": [{ "type": "close_dialogue" }]
                        }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_dispatcher_repeat",
            "npc_id": "npc_dispatcher",
            "start_node_id": "repeat",
            "nodes": [
                {
                    "node_id": "repeat",
                    "speaker_name": "Paul",
                    "lines": [
                        "Nice work out there.",
                        "If you want another run, I can dispatch a similar repair job."
                    ],
                    "choices": [
                        {
                            "choice_id": "again",
                            "text": "Send me another mission.",
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_repair_relay" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        {
                            "choice_id": "close",
                            "text": "Maybe later.",
                            "actions": [{ "type": "close_dialogue" }]
                        }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_citizen_smalltalk",
            "npc_id": "npc_citizen",
            "start_node_id": "hello",
            "nodes": [
                {
                    "node_id": "hello",
                    "speaker_name": "Local Citizen",
                    "lines": ["Welcome to the Warehouse District!", "Be careful around the damaged relay."],
                    "choices": [
                        {
                            "choice_id": "close",
                            "text": "Thanks.",
                            "actions": [{ "type": "close_dialogue" }]
                        }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_guard_root",
            "npc_id": "npc_guard",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Town Guard",
                    "lines": [
                        "Stay safe out there. The town has been restless lately.",
                        "If you see anything suspicious, let the team know."
                    ],
                    "choices": [
                        {
                            "choice_id": "deliver_poster",
                            "text": "Deliver Missing Poster",
                            "if": { "quest_active": "qt_side_missing_poster", "has_items": ["poster_missing"] },
                            "actions": [
                                {
                                    "type": "emit_event",
                                    "event": "DELIVER_ITEM",
                                    "payload": { "itemId": "poster_missing", "npcId": "npc_guard", "quantity": 1 }
                                },
                                { "type": "close_dialogue" }
                            ]
                        },
                        { "choice_id": "close", "text": "Understood.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_shopkeeper_root",
            "npc_id": "npc_shopkeeper",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Shopkeeper",
                    "lines": [
                        { "text": "Welcome! Our deliveries have been delayed." },
                        { "text": "I heard you found a hidden alley stash. Keep that key safe.", "if": { "flags_all": ["secret_alley_found"] } },
                        { "text": "If you can help stabilize town services, the whole district will benefit." }
                    ],
                    "choices": [
                        {
                            "choice_id": "start_power",
                            "text": "I can help with deliveries.",
                            "if": { "quest_completed": "qt_main_town_welcome", "quest_not_completed": "qt_main_town_power" },
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_main_town_power" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        {
                            "choice_id": "start_poster",
                            "text": "Any small side jobs?",
                            "if": { "quest_completed": "qt_main_town_welcome", "quest_not_active": "qt_side_missing_poster" },
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_side_missing_poster" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        { "choice_id": "close", "text": "I'll look around.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_mechanic_root",
            "npc_id": "npc_mechanic",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Mechanic",
                    "lines": [
                        "I can fix almost anything, but I need the right parts.",
                        "If you find a spare power cell, bring it to the garage."
                    ],
                    "choices": [
                        {
                            "choice_id": "deliver_cell",
                            "text": "Deliver the Power Cell",
                            "if": { "quest_active": "qt_main_town_power", "has_items": ["item_power_cell"] },
                            "actions": [
                                {
                                    "type": "emit_event",
                                    "event": "DELIVER_ITEM",
                                    "payload": { "itemId": "item_power_cell", "npcId": "npc_mechanic", "quantity": 1 }
                                },
                                { "type": "close_dialogue" }
                            ]
                        },
                        { "choice_id": "close", "text": "Got it.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_investigator_root",
            "npc_id": "npc_investigator",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Investigator",
                    "lines": [
                        "That city network terminal has logs that might explain the outages.",
                        "If you have an espionage specialist, you can access the deeper menus."
                    ],
                    "choices": [
                        {
                            "choice_id": "start_logs",
                            "text": "I can help you access the logs.",
                            "if": { "quest_completed": "qt_main_town_welcome", "quest_not_active": "qt_side_terminal_logs" },
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_side_terminal_logs" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        {
                            "choice_id": "start_relay",
                            "text": "Need help restoring the relay?",
                            "if": { "quest_completed": "qt_main_town_power", "quest_not_active": "qt_main_town_relay", "quest_not_completed": "qt_main_town_relay" },
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_main_town_relay" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        { "choice_id": "close", "text": "I'll check it.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_digger_root",
            "npc_id": "npc_digger",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Digger",
                    "lines": [
                        "The ground here hides old utility tunnels.",
                        "If we need to recover something, a digging companion can help."
                    ],
                    "choices": [
                        {
                            "choice_id": "start_cache",
                            "text": "Need help recovering anything?",
                            "if": { "quest_completed": "qt_main_town_welcome", "quest_not_active": "qt_side_buried_cache" },
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_side_buried_cache" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        { "choice_id": "close", "text": "Thanks.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_customer_root",
            "npc_id": "npc_customer",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Customer",
                    "lines": [
                        "I was waiting for a delivery... again.",
                        "Hopefully the town services come back soon."
                    ],
                    "choices": [
                        { "choice_id": "close", "text": "We'll help.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_resident_root",
            "npc_id": "npc_resident",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Resident",
                    "lines": [
                        "This house is small, but it has stories.",
                        "My kid has been posting flyers all day."
                    ],
                    "choices": [
                        {
                            "choice_id": "start_rescue",
                            "text": "Need help with anything?",
                            "if": { "quest_completed": "qt_main_town_welcome", "quest_not_active": "qt_side_animal_rescue" },
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_side_animal_rescue" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        { "choice_id": "close", "text": "Good to know.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_kid_root",
            "npc_id": "npc_kid",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Kid",
                    "lines": [
                        "Hi! I made a missing poster, but I can't find where I put it.",
                        "If you find it, can you bring it back?"
                    ],
                    "choices": [
                        {
                            "choice_id": "start_poster",
                            "text": "I'll help you find it.",
                            "if": { "quest_completed": "qt_main_town_welcome", "quest_not_active": "qt_side_missing_poster" },
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_side_missing_poster" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        { "choice_id": "close", "text": "I'll keep an eye out.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        },
        {
            "dialogue_id": "dlg_officer_root",
            "npc_id": "npc_officer",
            "start_node_id": "start",
            "nodes": [
                {
                    "node_id": "start",
                    "speaker_name": "Officer",
                    "lines": [
                        "The garage is busy today.",
                        "If you need clearance for a restricted area, call a police companion."
                    ],
                    "choices": [
                        {
                            "choice_id": "start_clearance",
                            "text": "I can clear the lockout.",
                            "if": { "quest_completed": "qt_main_town_welcome", "quest_not_active": "qt_side_garage_clearance" },
                            "actions": [
                                { "type": "quest_start", "quest_template_id": "qt_side_garage_clearance" },
                                { "type": "close_dialogue" }
                            ]
                        },
                        { "choice_id": "close", "text": "Understood.", "actions": [{ "type": "close_dialogue" }] }
                    ]
                }
            ]
        }
    ]
}
